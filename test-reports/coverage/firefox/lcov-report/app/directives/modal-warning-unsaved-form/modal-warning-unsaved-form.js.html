<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for app/directives/modal-warning-unsaved-form/modal-warning-unsaved-form.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../../prettify.css">
    <link rel="stylesheet" href="../../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">app/directives/modal-warning-unsaved-form/modal-warning-unsaved-form.js</span></h1>
    <h2>
        Statements: <span class="metric">79.49% <small>(31 / 39)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">100% <small>(8 / 8)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">76.92% <small>(10 / 13)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">79.49% <small>(31 / 39)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">app/directives/modal-warning-unsaved-form/</a> &#187; modal-warning-unsaved-form.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">47</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">47</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">47</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">48</span>
<span class="cline-any cline-yes">48</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">48</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">48</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">46</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">48</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">47</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">47</span>
<span class="cline-any cline-yes">49</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-yes">53</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * @author    Martin Micunda {@link http://martinmicunda.com}
 * @copyright Copyright (c) 2015, Martin Micunda
 * @license   GPL-3.0
 */
'use strict';
&nbsp;
import template from './modal-warning-unsaved-form.html!text';
import {Service, Inject, Directive} from '../../ng-decorators'; // jshint unused: false
&nbsp;
//start-non-standard
@Service({
    serviceName: 'UnsavedFormsService'
})
//end-non-standard
class UnsavedFormsService {
    constructor() {
        this.forms = [];
    }
&nbsp;
    add(form) {
        this.forms.push(form);
    }
&nbsp;
    remove(form) {
        const index = this.forms.indexOf(form);
&nbsp;
        this.forms.splice(index, 1);
    }
&nbsp;
    areFormsClean() {
        let areAllFormsClean = true;
        let clonedArray = this.forms.slice(0);
&nbsp;
        for(let form of clonedArray) {
            // `true` if user has already interacted with the form
            if (form.$dirty) {
                areAllFormsClean = false;
            } else {
                // remove any non dirty form from `forms` array
                this.remove(form);
            }
        }
&nbsp;
        return areAllFormsClean;
    }
}
&nbsp;
const MODAL = new WeakMap();
const STATE = new WeakMap();
const SERVICE = new WeakMap();
&nbsp;
//start-non-standard
@Directive({
    selector: 'mm-modal-warning-unsaved-form'
})
//end-non-standard
class MmModalWarningUnsavedForm {
    constructor($modal, $state, UnsavedFormsService) {
        this.require = '^form';
        this.restrict = 'A';
        this.scope = {
            resetForm: '&amp;mmModalWarningUnsavedForm'
        };
        MODAL.set(this, $modal);
        STATE.set(this, $state);
        SERVICE.set(this, UnsavedFormsService);
    }
&nbsp;
    link(scope, element, attrs, formCtrl) { // jshint unused: false
        SERVICE.get(MmModalWarningUnsavedForm.instance).add(formCtrl);
&nbsp;
        // alerts the user when he tries to change the state with unsaved changes
        const onRouteChangeOff = scope.$on('$stateChangeStart', function(event, toState) { // jshint unused: false
            if (!SERVICE.get(MmModalWarningUnsavedForm.instance).areFormsClean()) {
                MODAL.get(MmModalWarningUnsavedForm.instance).open({
                    template: template,
                    controller: ['$modalInstance', '$state', <span class="fstat-no" title="function not covered" >function($modalInstance, $state) {</span>
<span class="cstat-no" title="statement not covered" >                        var vm = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                        vm.ok = <span class="fstat-no" title="function not covered" >() =&gt; {</span></span>
<span class="cstat-no" title="statement not covered" >                            $modalInstance.close();</span>
<span class="cstat-no" title="statement not covered" >                            onRouteChangeOff(); </span>// stop listening for location changes
<span class="cstat-no" title="statement not covered" >                            $state.go(toState.name);</span>
<span class="cstat-no" title="statement not covered" >                            SERVICE.get(MmModalWarningUnsavedForm.instance).remove(formCtrl);</span>
<span class="cstat-no" title="statement not covered" >                            scope.resetForm(); </span>// reset form scope
                        };
&nbsp;
<span class="cstat-no" title="statement not covered" >                        vm.cancel = <span class="fstat-no" title="function not covered" >(</span>) =&gt; $modalInstance.dismiss('cancel');</span>
                    }],
                    controllerAs: 'vm'
                });
&nbsp;
                // prevent navigation by default since we'll handle it
                // once the user selects a dialog option
                event.preventDefault();
            }
        });
    }
&nbsp;
    //start-non-standard
    @Inject('$modal', '$state', 'UnsavedFormsService')
    //end-non-standard
    static directiveFactory($modal, $state, UnsavedFormsService){
        MmModalWarningUnsavedForm.instance = new MmModalWarningUnsavedForm($modal, $state, UnsavedFormsService);
        return MmModalWarningUnsavedForm.instance;
    }
}
&nbsp;
export {UnsavedFormsService, MmModalWarningUnsavedForm};
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Oct 26 2015 01:19:16 GMT+0000 (UTC)</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
